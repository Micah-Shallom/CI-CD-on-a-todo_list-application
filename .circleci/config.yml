version: 2.1
orbs: 
  gitleaks: upenn-libraries/gitleaks@1.0.0

commands:
  check_local:
    description: |
      Run Gitleaks against a local repository.
    parameters:
      path:
        default: ${CIRCLE_WORKING_DIRECTORY}
        description: Path to the local Git repository.
        type: string
    steps:
    - run:
        name: Check repository for secrets
        command: |
          # gitleaks --repo-path=<< parameters.path >>
          ls .
          gitleaks detect -v --exit-code

jobs:
  check_local:
    description: |
      Clone a Git repository and check it for secrets.
    docker:
      - image: zricethezav/gitleaks
    steps:
    - checkout
    - check_local

workflows:
  test-workflows:
    jobs:
      - check_local