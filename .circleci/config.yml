version: 2.1
orbs: 
  gitleaks: upenn-libraries/gitleaks@1.0.0

jobs:
    check_local:
        description: |
            Clone a Git repository and check it for secrets.
        executor:
            image: << parameters.image >>
            name: docker
        parameters:
            image:
                default: zricethezav/gitleaks
                description: |
                    The Gitleaks Docker image to use when checking a repository. It is
                    recommended that you publish your own image instead of trusting an image
                    that you don't control.
                type: string
            options:
                default: ""
                description: Additional options to pass to the Gitleaks CLI.
                type: string
        steps:
            - checkout
            - check_local:
                options: << parameters.options >>
        working_directory: /root/project
workflows:
  check_for_secrets:
    jobs:
      - gitleaks/check_local